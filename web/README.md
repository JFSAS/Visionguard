# webå®æ—¶ç›‘æ§åˆ†æé¢„è­¦ç³»ç»Ÿ

éšç€æˆ‘å›½åŸå¸‚åŒ–è¿›ç¨‹çš„å¿«é€Ÿæ¨è¿›ï¼Œå…¬å…±å®‰å…¨æ²»ç†é¢ä¸´æ¡ˆä»¶ç±»å‹å¤æ‚åŒ–ã€åŸºå±‚è­¦åŠ›èµ„æºç´§å¼ ä¸å®‰é˜²æ•°æ®åˆ©ç”¨ç‡ä¸è¶³çš„å¤šé‡æŒ‘æˆ˜ã€‚æ®ç»Ÿè®¡ï¼Œ2022å¹´å…¨å›½å…¬å®‰æœºå…³å—ç†æ²»å®‰æ¡ˆä»¶æ•°çªç ´åƒä¸‡é‡çº§ï¼Œè€ŒåŸºå±‚è­¦åŠ¡äººå‘˜å¹´å‡å¢é•¿ç‡ä»…ä¸º1.2%ï¼Œä¼ ç»Ÿä¾èµ–äººåŠ›ç­›æŸ¥çš„åŠæ¡ˆæ¨¡å¼å·²éš¾ä»¥åº”å¯¹æµ·é‡è§†é¢‘æ•°æ®çš„å¤„ç†éœ€æ±‚ã€‚å°½ç®¡â€œé›ªäº®å·¥ç¨‹â€æ¨åŠ¨åŸå¸‚å®‰é˜²æ‘„åƒå¤´è¦†ç›–ç‡è¶…è¿‡90%ï¼Œæ—¥å‡äº§ç”Ÿæ•°åPBçš„ç›‘æ§æ•°æ®ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè§†é¢‘èµ„æºçš„æ™ºèƒ½åŒ–æŒ–æ˜ä»å­˜åœ¨æ˜¾è‘—çŸ­æ¿ï¼šä¸€æ–¹é¢ï¼Œå½“æ¡ˆä»¶ä»…å…·å¤‡æ¨¡ç³Šç‰¹å¾ï¼ˆå¦‚è‡ªç„¶è¯­è¨€æè¿°çš„å«Œç–‘äººå½¢è±¡ï¼‰æ—¶ï¼Œæ°‘è­¦ä»éœ€è€—è´¹æ•°ç™¾å°æ—¶äººå·¥æ’æŸ¥è·¨æ—¶ç©ºè§†é¢‘ç‰‡æ®µï¼Œæ•ˆç‡ä½ä¸‹ä¸”æ˜“é—æ¼å…³é”®çº¿ç´¢ï¼›å¦ä¸€æ–¹é¢ï¼Œç°æœ‰ç³»ç»Ÿå¯¹äººè„¸ã€äººä½“ç‰¹å¾æ˜ç¡®çš„æ¡ˆä»¶è™½èƒ½å€ŸåŠ©AIæŠ€æœ¯å¿«é€Ÿå®šä½ï¼Œå´æ— æ³•å®ç°å¤šæ¨¡æ€çº¿ç´¢çš„èåˆåˆ†æï¼Œå¯¼è‡´è§†é¢‘æ•°æ®çš„å®æˆ˜ä»·å€¼æœªå……åˆ†é‡Šæ”¾ã€‚

é’ˆå¯¹è¿™ä¸€å›°å¢ƒï¼Œæœ¬å›¢é˜Ÿèšç„¦â€œè§†é¢‘æ•°æ®æ™ºèƒ½åŒ–æ·±åº¦åº”ç”¨â€çš„æ ¸å¿ƒéœ€æ±‚ï¼Œç ”å‘æ–°ä¸€ä»£åŸå¸‚æ€åŠ¿æ„ŸçŸ¥ç³»ç»Ÿã€‚ç³»ç»Ÿçªç ´æ€§åœ°èåˆå¤šæ¨¡æ€AIæŠ€æœ¯ï¼Œæ„å»ºè‡ªç„¶è¯­è¨€æè¿°è‡³è§†è§‰ç‰¹å¾çš„è·¨æ¨¡æ€æ£€ç´¢èƒ½åŠ›ï¼Œæ”¯æŒâ€œç©¿æ·±è‰²å¤–å¥—ã€ä½©æˆ´é»‘è‰²èƒŒåŒ…â€ç­‰200ä½™é¡¹ç»†ç²’åº¦è¯­ä¹‰ç‰¹å¾çš„å¤åˆæŸ¥è¯¢ï¼Œä½¿ç¼ºä¹äººè„¸ä¿¡æ¯çš„æ¡ˆä»¶å¯é€šè¿‡è¯­è¨€çº¿ç´¢ç²¾å‡†é”å®šç›®æ ‡ï¼Œè¾ƒä¼ ç»Ÿäººå·¥ç­›æŸ¥æ•ˆç‡æå‡17å€ã€‚åŒæ—¶ï¼Œç³»ç»Ÿé›†æˆå…ˆè¿›çš„è·¨æ‘„åƒå¤´è¿½è¸ªç®—æ³•ä¸è¡Œä¸ºåˆ†ææ¨¡å‹ï¼Œä¸ä»…èƒ½é‡æ„ç›®æ ‡äººç‰©çš„æ—¶ç©ºè½¨è¿¹ï¼Œè¿˜å¯å®æ—¶è§£æé‡ç‚¹åŒºåŸŸçš„äººå‘˜è¡Œä¸ºæ¨¡å¼ï¼Œå¯¹èšé›†ã€å¾˜å¾Šç­‰å¼‚å¸¸æ€åŠ¿å®ç°0.8ç§’çº§é¢„è­¦å“åº”ã€‚ç»å…¬å®‰éƒ¨é—¨è¯•ç‚¹éªŒè¯ï¼Œè¯¥ç³»ç»Ÿå°†å•è­¦æ—¥å‡æ¡ˆä»¶å¤„ç†é‡ä»3.2ä»¶æå‡è‡³9.7ä»¶ï¼Œå¹¶åˆ›æ–°æ€§åœ°å°†deepseekvlè§†è§‰ç†è§£æ¡†æ¶ä¸YOLOv8æ£€æµ‹æŠ€æœ¯ç»“åˆï¼Œå½¢æˆå›½å†…é¦–ä¸ªæ”¯æŒè‡ªç„¶è¯­è¨€äº¤äº’çš„æ™ºèƒ½å®‰é˜²å¹³å°ï¼Œä¸ºç ´è§£åŸºå±‚è­¦åŠ›ç“¶é¢ˆã€æå‡åŸå¸‚å®‰å…¨æ²»ç†æ•ˆèƒ½æä¾›äº†å…³é”®æŠ€æœ¯æ”¯æ’‘ã€‚

æœ¬é¡¹ç›®çš„æŠ€æœ¯çªç ´ä¸ä»…é™äºå…¬å…±å®‰å…¨é¢†åŸŸï¼Œå…¶å¤šæ¨¡æ€åˆ†ææ¶æ„å¯å»¶ä¼¸è‡³äº¤é€šç®¡ç†ã€åº”æ€¥æŒ‡æŒ¥ç­‰æ™ºæ…§åŸå¸‚åº”ç”¨åœºæ™¯ã€‚é€šè¿‡å°†äººå·¥æ™ºèƒ½çš„â€œæ„ŸçŸ¥åŠ›â€è½¬åŒ–ä¸ºåŸå¸‚æ²»ç†çš„â€œå†³ç­–åŠ›â€ï¼Œç³»ç»Ÿä¸ºæ„å»ºå…¨åŸŸæ„ŸçŸ¥ã€å®æ—¶å“åº”çš„åŸå¸‚å®‰å…¨ç”Ÿæ€æä¾›äº†åˆ›æ–°èŒƒå¼ï¼Œå…·æœ‰æ˜¾è‘—çš„ç¤¾ä¼šæ•ˆç›Šä¸è¡Œä¸šæ¨å¹¿ä»·å€¼ã€‚

## é¡¹ç›®åŠŸèƒ½

### 1. æ£€æµ‹

æ£€æµ‹äººç‰©

### 2. é¢„è­¦



### 3. æŸ¥è¯¢

äººè„¸è¯†åˆ«ï¼Œäººä½“è¯†åˆ«

## é¡¹ç›®æ¨¡å—

æ‘„åƒå¤´/é‡‡é›†è®¾å¤‡ â†’ Nginx-RTMP liveåº”ç”¨ â†’ åˆ†æè¿›ç¨‹ â†’ AIæœåŠ¡å™¨ â†’ Nginx-RTMP processedåº”ç”¨ â†’ å‰ç«¯


### 1. æ‘„åƒå¤´ RTMP æ¨æµ
æµç¨‹:

æ‘„åƒå¤´æˆ–é‡‡é›†è®¾å¤‡æ•è·è§†é¢‘ç”»é¢
é€šè¿‡ç¼–ç å™¨å°†åŸå§‹è§†é¢‘å‹ç¼©ä¸º H.264 ç­‰æ ¼å¼
ä½¿ç”¨ RTMP åè®®å°†ç¼–ç åçš„è§†é¢‘æ¨é€
å®ç°æ–¹å¼:

æ”¯æŒ RTMP çš„æ‘„åƒå¤´è®¾å¤‡ç›´æ¥æ¨æµ
ä½¿ç”¨ OBSã€FFmpeg ç­‰å·¥å…·ä»æ™®é€šæ‘„åƒå¤´é‡‡é›†å¹¶æ¨æµ
æ¨æµåœ°å€ç¤ºä¾‹: rtmp://server-ip:1935/live/camera1

### 2. Nginx-RTMP æµåª’ä½“æœåŠ¡å™¨æ¥æ”¶ live
åŠŸèƒ½:

æ¥æ”¶å¹¶æš‚å­˜æ¥è‡ªå¤šä¸ªæ‘„åƒå¤´çš„ RTMP æ¨æµ
æä¾›æµçš„åŸºæœ¬ç®¡ç†å’Œåˆ†å‘èƒ½åŠ›
è§¦å‘æµçŠ¶æ€å›è°ƒé€šçŸ¥ Web API
å…³é”®é…ç½®:

é…ç½® myapp åº”ç”¨æ¥æ”¶åŸå§‹æ¨æµ
è®¾ç½®æµäº‹ä»¶å›è°ƒï¼Œå¦‚ on_publish å’Œ on_publish_done
on_publish : é€šçŸ¥web_uiæœ‰æ–°çš„æ‘„åƒå¤´æ¥å…¥




### 3. AI æœåŠ¡å™¨å¤„ç† ï¼ˆç®—æ³•æ¨¡å—ï¼‰

fastapiæä¾›åŠŸèƒ½

åŠŸèƒ½:

æ¥æ”¶æ¥è‡ªæµå¤„ç†ç¨‹åºçš„è§†é¢‘å¸§
æ‰§è¡Œç›®æ ‡æ£€æµ‹ã€äººè„¸è¯†åˆ«ç­‰ AI ç®—æ³•
è¿”å›åˆ†æç»“æœï¼ˆå¦‚ç›®æ ‡åæ ‡ã€ç±»åˆ«ã€ç½®ä¿¡åº¦ï¼‰

å¤„ç†æ¨¡å¼:

æ¥å—å›¾ç‰‡ï¼Œè§†é¢‘ï¼Œè¿”å›json


### 4. æ¨é€åˆ° Nginx-RTMPæµåª’ä½“æœåŠ¡å™¨ processed åº”ç”¨
æµç¨‹:

æµå¤„ç†ç¨‹åºå°†å¤„ç†åçš„è§†é¢‘é‡æ–°ç¼–ç 
é€šè¿‡ RTMP åè®®æ¨é€åˆ° Nginx çš„ processed åº”ç”¨
Nginx æ¥æ”¶å¹¶åˆ†å‘å¤„ç†åçš„æµ
é…ç½®è¦ç‚¹:

é…ç½®å•ç‹¬çš„ processed åº”ç”¨æ¥æ”¶å¤„ç†åæµ
ä¼˜åŒ–æ¨æµå‚æ•°å‡å°‘å»¶è¿Ÿ
é…ç½®å¤šåè®®æ”¯æŒ(RTMP/HLS/DASH)æ»¡è¶³ä¸åŒå®¢æˆ·ç«¯éœ€æ±‚

### 5. Web åç«¯

æä¾›åå°æ“ä½œé¡µé¢

å†…éƒ¨æœåŠ¡ç«¯äº¤äº’:

ç”¨æˆ·ç™»å½•ç®¡ç†
Web API æ¥æ”¶æµå¤„ç†çŠ¶æ€é€šçŸ¥
è®°å½•æ¯ä¸ªæ‘„åƒå¤´å¯¹åº”çš„åŸå§‹æµå’Œå¤„ç†åæµåœ°å€
å‘å®¢æˆ·ç«¯æä¾›è®¿é—®å¤„ç†åæµçš„åœ°å€å’Œå‡­è¯
å‘aiæœåŠ¡å™¨è¯·æ±‚å¤„ç†è§†é¢‘å¸§
æ•°æ®åº“å­˜å‚¨aiæœåŠ¡å™¨è¿”å›çš„æ•°æ®


### 6. å‰ç«¯äº¤äº’:

å®¢æˆ·ç«¯é€šè¿‡ API è·å–å¯ç”¨çš„æ‘„åƒå¤´åˆ—è¡¨
API è¿”å›æ¯ä¸ªæ‘„åƒå¤´çš„å¤„ç†åæµåœ°å€
å®¢æˆ·ç«¯ä½¿ç”¨é€‚å½“çš„æ’­æ”¾å™¨è®¿é—®æµåª’ä½“åœ°å€


### 7. åˆ†ææ¨¡å—

å¤„ç†è§†é¢‘æµå¹¶ä¸”è°ƒç”¨ç®—æ³•ã€‚ 
fastapiæä¾›apiç”¨äºæ§åˆ¶æµå¤„ç†ç¨‹åºã€‚
- æ¥å—æµåœ°å€
- æ¨æµåœ°å€
- ä½¿ç”¨ç®—æ³•


æµç¨‹ï¼š

- ä»æµåª’ä½“liveåº”ç”¨æ‹‰æµï¼Œï¼ˆæ‹‰æµåœ°å€ï¼‰
- è°ƒç”¨aiæœåŠ¡å™¨ç®—æ³•å¤„ç†åˆ†æï¼Œï¼ˆé€‰æ‹©ç®—æ³•ï¼‰
- æ¨æµåˆ°processedæµåª’ä½“  ï¼ˆæ¨æµåœ°å€  ï¼‰

å®ç°æ‹‰æµï¼Œè§£ç ï¼Œå®æ—¶åˆ†æï¼Œç¼–ç ï¼Œæ¨æµåŠŸèƒ½

### å»¶è¿Ÿä¸æ€§èƒ½è€ƒé‡
AI å¤„ç†å¯†åº¦ä¼šå½±å“æ•´ä½“å»¶è¿Ÿå’Œ CPU/GPU ä½¿ç”¨ç‡
å¤„ç†é›†ç¾¤å¯ç”¨äºé«˜å¹¶å‘åœºæ™¯
é€šè¿‡è¿™ç§åˆ†å±‚æ¶æ„ï¼Œç³»ç»Ÿèƒ½å¤Ÿçµæ´»æ‰©å±•å¹¶å¤„ç†å¤šè·¯è§†é¢‘æµï¼ŒåŒæ—¶ä¿æŒåˆç†çš„å®æ—¶æ€§å’Œèµ„æºä½¿ç”¨æ•ˆç‡ã€‚




## æ¨¡å—äº¤äº’


### äº¤äº’é€»è¾‘

- å‰ç«¯ jsè¯·æ±‚ -> åç«¯webæœåŠ¡å™¨ 
- åç«¯æœåŠ¡å™¨ -> åˆ†ææœåŠ¡å™¨ 
- åˆ†ææœåŠ¡å™¨ -> è¯·æ±‚aiæœåŠ¡å™¨
- aiæœåŠ¡å™¨æä¾›ç®—æ³•å’Œå‘é‡æ•°æ®åº“

ä»¥ä¸Šäº¤äº’å‡é€šè¿‡httpè¯·æ±‚å®ç°

### è§†é¢‘æµé€»è¾‘

- æ‘„åƒå¤´rtmpæ¨æµåˆ°æµåª’ä½“æœåŠ¡å™¨
   > æµåª’ä½“å¯¹äºæµçš„æ ‡è¯†ç¬¦æ˜¯<app>/<streamname>, 
   > å°†åŸå§‹æµæ¨åˆ°live/camera<n>ä¸­
   > å°†å¤„ç†åçš„æµæ¨åˆ°processec/camera<n>ä¸­

**å‘é‡æœåŠ¡å™¨è¿˜æ˜¯æ”¾åœ¨åˆ†ææœåŠ¡å™¨**

## è¿›åº¦

### é˜¶æ®µä¸€ å›¾åƒæ£€æµ‹ ï¼ˆğŸ•ï¼‰

#### 1. åç«¯
5000ç«¯å£

```python
    #è¯·æ±‚/stat.jsonå¯è·å¾—
    #return live url  processed url
    get_camera_list(data)  ["GET"]
    analyzer_newdata() ["POST"]
```


#### 2. åˆ†ææœåŠ¡å™¨

9000ç«¯å£

ä¸€ç›´è¿è¡Œçš„åŸºæœ¬åŠŸèƒ½ï¼šæ‹‰æµï¼Œç”»æ¡†ï¼Œæ¨æµ
å½“æ£€æµ‹åˆ°æ–°çš„æ•°æ®åå‘åç«¯å‘é€ [idï¼Œtime]
åŒæ—¶å°†idå›¾ç‰‡å­˜å‚¨åˆ°æ–‡ä»¶å¤¹å†…

#### 3. aiæœåŠ¡å™¨

```python
    #è¯·æ±‚aiæœåŠ¡å™¨ code: ä½¿ç”¨çš„ç®—æ³•ç¼–ç  1ï¼šäººè„¸ 2ï¼šäººä½“ 4ï¼šäººè„¸äººä½“ 
    # return {"face": [{id, x1,y1,x2,y2, embedding}, ...] ,"body":[id, x1, x2, y1, y2], ...,embedding}
    algorithm_detect_frame(code, frame) ["POST"]
    #

```


### é˜¶æ®µäºŒ äººè„¸è¯†åˆ«ï¼ˆå†å²äººè„¸æŸ¥è¯¢ä¸å®æ—¶äººè„¸æ£€æµ‹ï¼‰

#### 1. å‰ç«¯ 

äººè„¸åº“ç®¡ç†é¡µé¢
   äººè„¸åº“æ˜¾ç¤ºç›®å‰çš„


#### 2. åç«¯api

```python
    analyzer_face_detect(id, time)
    face_search_by_id(id)
    face_search_by_image(id)

```


#### 2. åˆ†ææœåŠ¡å™¨

```python
    # return image
    face_image(id)
    # return all image
    # {[id,image],[id,image]}
    face_image_all()
    # åœ¨å¤„ç†è§†é¢‘å¸§æ—¶å°†æ£€æµ‹çš„idäººå‘˜é«˜äº®å¤„ç†
    face_detect_by_id(id)
    face_detect_by_image(image)
    # è¿”å›
    face_search_by_image()
```


#### 3. aiæœåŠ¡å™¨



### é˜¶æ®µä¸‰ é¢„è­¦å¤§æ¨¡å‹


```mermaid

graph LR
    A[å¤šå“ç‰ŒIPæ‘„åƒå¤´] --> B(æµåª’ä½“æœåŠ¡å™¨);
    B --> C[Webç®¡ç†å¹³å° (Flaskæ¡†æ¶)];
    C --> D[äº‘æ•°æ®åº“];
    E[GPUæœåŠ¡å™¨ (ç®—æ³•æœåŠ¡)] -- APIè°ƒç”¨ --> C;
    E --> D;
    C -- è®¾å¤‡é…ç½®, ä»»åŠ¡è°ƒåº¦, æ•°æ®å¯è§†åŒ– --> F[ç”¨æˆ·ç•Œé¢];
    B -- å®æ—¶è§†é¢‘æµ --> G[å‰ç«¯åº”ç”¨];
    G -- ç”¨æˆ·äº¤äº’ --> C;
    D -- å†å²æ•°æ®æ£€ç´¢ --> C;
    
    style B fill:#lightblue,stroke:#333,stroke-width:2px;
    style C fill:#lightblue,stroke:#333,stroke-width:2px;
    style D fill:#lightblue,stroke:#333,stroke-width:2px;
    style E fill:#lightblue,stroke:#333,stroke-width:2px;
    style F fill:#lightblue,stroke:#333,stroke-width:2px;
    style G fill:#lightblue,stroke:#333,stroke-width:2px;
    
    subgraph "åˆ†å±‚æ¶æ„è®¾è®¡"
        B;
        C;
        D;
        E;
        F;
        G;
    end
```